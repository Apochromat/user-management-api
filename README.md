# user-management-api
Это тестовое задание для COMPANY_NAME на позицию Бэкенд-разработчик (API).

## Задача
Необходимо реализовать API приложение на ASP.NET Core 5+.

### Требования бизнес-логики и ограничения:
1. Формат запроса/ответа должен быть JSON.
2. Методы API должны быть асинхронными.
3. В качестве СУБД необходимо использовать Postgres.
4. В качестве ORM необходимо использовать EF Core.
5. В качестве моделей данных должны использоваться следующие сущности:
   - user (id, login, password, created_date, user_group_id, user_state_id)
   - user_group (id, code, description). Возможные значения для code (Admin, User)
   - user_state (id, code, description). Возможные значения для code (Active, Blocked).
6. Приложение должно позволять добавлять/удалять/получать пользователей. Получить можно как одного, так и всех пользователей (добавление/удаление только по одному). При получении пользователей должна возвращаться полная информация о них (с user_group и user_state).
7. Система должна не позволять иметь более одного пользователя с user_group.code = “Admin”.
8. После успешной регистрации нового пользователя, ему должен быть выставлен статус "Active". Добавление нового пользователя должно занимать 5 сек. За это время при попытке добавления пользователя с таким же login должна возвращаться ошибка.
9. Удаление пользователя должно осуществляться не путём физического удаления из таблицы, а путём выставления статуса "Blocked" у пользователя.
10. Допускается добавлять вспомогательные данные в существующие таблицы.

### Опционально
- В качестве способа авторизации следует использовать Basic-авторизацию.
- Реализовать пагинацию для получения нескольких пользователей.
- Написать unit-тесты с помощью xUnit.

## Специфика решения
Следуя ответу из тикета №6424, если что-то не указано прямо в задании, я могу сделать это по-своему и прокомментировать свой выбор. Комментарии по решению находятся ниже.
- В тикете №6401 было разрешено использование Identity, что повлияло на структуру сущности user. Она теперь наследуется от IdentityUser и имеет дополнительные поля, которые не были указаны в задании. Так:
  - Id, UserGroupId, UserStateId, CreatedDate - сохраняются в точности как то ТЗ.
  - Вместо login используется UserName, который является уникальным идентификатором пользователя по умолчанию.
  - Вместо password используется PasswordHash, который хранит хэш пароля.
- Я решил, что следующая фраза означает, что в системе может быть только один пользователь с ролью администратора. Поэтому при регистрации я запрашиваю список активных пользователей с группой "Admin" и, если он не пустой, то возвращаю ошибку. При этом если удалить пользователя с группой "Admin", его место сможет занять кто-то другой.
- 
    >В пункте 7 требований указано, что система не должна позволять иметь более одного пользователя с user_group.code = “Admin”.

- Несколько пояснений по пункту 8:
  - Для того чтобы я всегда мог иметь статусы и группы в системе, при старте приложения я проверяю их на существование в БД и создаю их, если они отсутствуют.
  
    >После успешной регистрации нового пользователя, ему должен быть выставлен статус "Active".

  - Я решил, что следующая фраза означает, что при попытке добавить пользователя с таким же UserName должна возвращаться ошибка, а сам запрос должен выполняться не более 5 секунд. При этом, если бы речь шла о дополнительной задержке в 5 секунд, я должен разрешать регистрироваться с одинаковыми UserName по прошествии 5 секунд, что противоречит логике уникальности пользователей. Однако, в файле UserService.cs в UserManagement.BLL.Services на 75 строке есть закомментированный код, который позволяет добавить задержку.
  
    >Добавление нового пользователя должно занимать 5 сек. За это время при попытке добавления пользователя с таким же login должна возвращаться ошибка. 
    
- Я реализовал несколько тестов с помощью xUnit, но получилось что-то похожее на интеграционные тесты. Мои навыки написания тестов можно увидеть [тут](https://github.com/Apochromat/dotnet-partition-labels-testing).
- Авторизация. Так как не сказано ничего про возможности авторизации разных пользователей, то пользователи со статусом "Blocked" не могут войти в систему.